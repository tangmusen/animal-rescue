<!-- pages/forum/forum.wxml -->
<view class="container">
  <!-- å‘å¸ƒè®ºå›æ  -->
  <view class="publish-card" bindtap="goToPublish">
    <view class="publish-content">
      <view class="publish-left">
        <text class="publish-emoji">âœï¸</text>
        <view class="publish-text">
          <text class="publish-title">æ•‘åŠ©è®ºå›</text>
          <text class="publish-desc">å‘å¸ƒ</text>
        </view>
      </view>
      <text class="arrow-right">âœ</text>
    </view>
  </view>

  <!-- åˆ†ç±»æ ‡ç­¾ -->
  <view class="category-tabs">
    <view class="tab-item {{currentTab === 'all' ? 'active' : ''}}" bindtap="switchTab" data-tab="all">
      <text class="tab-emoji">ğŸŒ</text>
      <text>æ‰€æœ‰è®ºå›</text>
    </view>
    <view class="tab-item {{currentTab === 'nearby' ? 'active' : ''}}" bindtap="switchTab" data-tab="nearby">
      <text class="tab-emoji">ğŸ“</text>
      <text>é™„è¿‘è®ºå›</text>
    </view>
    <view class="tab-item {{currentTab === 'community' ? 'active' : ''}}" bindtap="switchTab" data-tab="community">
      <text class="tab-emoji">ğŸ˜ï¸</text>
      <text>å°åŒºè®ºå›</text>
    </view>
  </view>

  <!-- è®ºå›åˆ—è¡¨ -->
  <scroll-view class="forum-list" scroll-y>
    <block wx:for="{{posts}}" wx:key="id">
      <view class="forum-card">
        <!-- å‘å¸–äººä¿¡æ¯ -->
        <view class="poster-info">
          <image class="poster-avatar" src="{{item.authorAvatar || '/images/default-avatar.png'}}" mode="aspectFill"></image>
          <view class="poster-details">
            <text class="poster-name">{{item.author || 'åŒ¿åç”¨æˆ·'}}</text>
            <view class="post-meta">
              <text class="post-time">{{item.createTime || 'åˆšåˆš'}}</text>
              <text class="post-location" wx:if="{{item.distance}}">Â· {{item.distance}}</text>
            </view>
          </view>
          <!-- å¸–å­æ ‡ç­¾ -->
          <view class="post-tag" wx:if="{{item.postType === 'rescue'}}">
            <text class="tag-emoji">ğŸ†˜</text>
            <text>æ•‘åŠ©</text>
          </view>
          <view class="post-tag emergency" wx:elif="{{item.isEmergency}}">
            <text class="tag-emoji">âš¡</text>
            <text>ç´§æ€¥</text>
          </view>
        </view>

        <!-- å¸–å­å†…å®¹ -->
        <view class="post-content">
          <text class="post-title">{{item.title || 'æ— æ ‡é¢˜'}}</text>
          <text class="post-text">{{item.content || ''}}</text>
          
          <!-- å›¾ç‰‡ -->
          <view class="post-images" wx:if="{{item.images && item.images.length > 0}}">
            <block wx:for="{{item.images}}" wx:for-item="img" wx:for-index="imgIndex" wx:key="imgIndex">
              <image class="post-image" src="{{img}}" mode="aspectFill" bindtap="previewImage" data-url="{{img}}" data-urls="{{item.images}}"></image>
            </block>
          </view>
        </view>

        <!-- äº’åŠ¨æ  -->
        <view class="post-actions">
          <view class="action-item" bindtap="likePost" data-id="{{item.id}}">
            <text class="action-icon {{item.isLiked ? 'liked' : ''}}">{{item.isLiked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
            <text class="action-text">{{item.likes || 0}}</text>
          </view>
          <view class="action-item" bindtap="viewPost" data-id="{{item.id}}">
            <text class="action-icon">ğŸ’¬</text>
            <text class="action-text">{{item.comments || 0}}</text>
          </view>
          <view class="action-item" bindtap="sharePost" data-id="{{item.id}}">
            <text class="action-icon">ğŸ“¤</text>
            <text class="action-text">åˆ†äº«</text>
          </view>
        </view>
      </view>
    </block>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="load-more" wx:if="{{loading}}">
      <text>åŠ è½½ä¸­...</text>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty" wx:if="{{posts.length === 0 && !loading}}">
      <text class="empty-emoji">ğŸ“­</text>
      <text class="empty-text">æš‚æ— è®ºå›å†…å®¹</text>
      <text class="empty-desc">å¿«æ¥å‘å¸ƒç¬¬ä¸€æ¡æ•‘åŠ©ä¿¡æ¯å§</text>
    </view>
  </scroll-view>
</view>