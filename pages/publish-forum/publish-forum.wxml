<!-- pages/publish-forum/publish-forum.wxml -->
<view class="container">
  <!-- 页面标题栏 -->
  <view class="page-header">
    <text class="header-title">发布救助信息</text>
    <text class="header-subtitle">请详细填写救助信息，便于志愿者快速响应</text>
  </view>

  <scroll-view class="form-container" scroll-y>
    <!-- 帖子类型选择卡片 -->
    <view class="info-card">
      <view class="card-header">
        <view class="header-icon">📋</view>
        <text class="card-title">帖子类型</text>
      </view>
      
      <view class="post-type-options">
        <view class="type-item {{postType === 'normal' ? 'active' : ''}}" bindtap="setPostType" data-type="normal">
          <text class="type-emoji">💬</text>
          <text class="type-text">普通帖子</text>
          <text class="type-desc">日常交流讨论</text>
        </view>
        <view class="type-item rescue {{postType === 'rescue' ? 'active' : ''}}" bindtap="setPostType" data-type="rescue">
          <text class="type-emoji">🆘</text>
          <text class="type-text">救助帖</text>
          <text class="type-desc">紧急救助信息</text>
        </view>
      </view>
    </view>

    <!-- 基本信息卡片 -->
    <view class="info-card">
      <view class="card-header">
        <view class="header-icon">📝</view>
        <text class="card-title">基本信息</text>
      </view>
      
      <view class="form-group">
        <view class="label-row">
          <text class="label">标题</text>
          <text class="required">*</text>
        </view>
        <input class="input-field" 
               placeholder="请输入帖子标题" 
               value="{{title}}"
               bindinput="inputTitle"
               maxlength="50" />
        <text class="hint">{{title.length}}/50</text>
      </view>

      <view class="form-group">
        <view class="label-row">
          <text class="label">详细描述</text>
          <text class="required">*</text>
        </view>
        <textarea class="textarea-field" 
                  placeholder="请详细描述需要救助的情况，包括动物状态、位置、紧急程度等信息" 
                  value="{{content}}"
                  bindinput="inputContent"
                  maxlength="500"
                  show-confirm-bar="false" />
        <text class="hint">{{content.length}}/500</text>
      </view>
    </view>

    <!-- 图片上传卡片 -->
    <view class="info-card">
      <view class="card-header">
        <view class="header-icon">📷</view>
        <text class="card-title">现场照片</text>
        <text class="card-subtitle">（最多9张）</text>
      </view>
      
      <view class="image-grid">
        <!-- 已上传的图片 -->
        <block wx:for="{{images}}" wx:key="index">
          <view class="image-item">
            <image class="upload-image" src="{{item}}" mode="aspectFill" bindtap="previewImage" data-index="{{index}}"></image>
            <view class="delete-btn" bindtap="deleteImage" data-index="{{index}}">
              <text class="delete-icon">×</text>
            </view>
          </view>
        </block>
        
        <!-- 添加图片按钮 -->
        <view class="image-item add-btn" wx:if="{{images.length < 9}}" bindtap="chooseImage">
          <view class="add-content">
            <text class="add-icon">+</text>
            <text class="add-text">添加照片</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 紧急程度卡片（仅救助帖显示） -->
    <view class="info-card" wx:if="{{postType === 'rescue'}}">
      <view class="card-header">
        <view class="header-icon">⚡</view>
        <text class="card-title">紧急程度</text>
      </view>
      
      <view class="emergency-options">
        <view class="option-item {{!isEmergency ? 'active' : ''}}" bindtap="setEmergency" data-value="{{false}}">
          <text class="option-emoji">🔵</text>
          <text class="option-text">一般</text>
          <text class="option-desc">可以等待处理</text>
        </view>
        <view class="option-item emergency {{isEmergency ? 'active' : ''}}" bindtap="setEmergency" data-value="{{true}}">
          <text class="option-emoji">🔴</text>
          <text class="option-text">紧急</text>
          <text class="option-desc">需要立即救助</text>
        </view>
      </view>
    </view>

    <!-- 联系方式卡片（仅救助帖显示） -->
    <view class="info-card" wx:if="{{postType === 'rescue'}}">
      <view class="card-header">
        <view class="header-icon">📞</view>
        <text class="card-title">联系方式</text>
      </view>
      
      <view class="form-group">
        <view class="label-row">
          <text class="label">联系电话</text>
        </view>
        <input class="input-field" 
               type="number"
               placeholder="请输入联系电话（选填）" 
               value="{{phone}}"
               bindinput="inputPhone"
               maxlength="11" />
      </view>

      <view class="form-group">
        <view class="label-row">
          <text class="label">微信号</text>
        </view>
        <input class="input-field" 
               placeholder="请输入微信号（选填）" 
               value="{{wechat}}"
               bindinput="inputWechat"
               maxlength="30" />
      </view>
    </view>

    <!-- 底部占位 -->
    <view class="bottom-placeholder"></view>
  </scroll-view>

  <!-- 底部按钮 -->
  <view class="bottom-bar">
    <button class="btn-cancel" bindtap="cancel">取消</button>
    <button class="btn-submit {{(!title || !content) ? 'disabled' : ''}}" 
            bindtap="submitPost"
            disabled="{{!title || !content}}">
      发布
    </button>
  </view>
</view>